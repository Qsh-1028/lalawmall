webpackJsonp([121],{NSeO:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=e("woOf"),o=e.n(s),a=e("Gu7T"),n=e.n(a),c=e("Dd8w"),d=e.n(c),l=e("NYxO"),r=e("Cz8s"),v=e("RoZr"),p=e("Vr3d"),g=e("NPH5"),u={components:{PublicHeader:r.a,StoreCart:v.a,GoodsHandle:p.a,Load:g.a},data:function(){return{sid:0,cid:0,goodsActive:{},goodsAll:[],goodsItem:{page:2,psize:30,loading:!1,finished:!1,empty:0,data:[]},categorySelectedIndex:0,categorySelectedId:0,categoryAll:[],categorySelected:{child:[{}]},childSelectedIndex:0,childSelectedId:0,store:{},cart:{},lazyload_goods:"",showMoveDot:[],popupBuySvip:!1,popupNotInSailTime:!1,ParentPopupSpecShow:!1,windowHeight:0,showPreLoading:!0}},methods:d()({},Object(l.b)(["replaceStore","replaceCart","replaceState"]),{onLoad:function(){var t=this,i=this;i.util.request({url:"wmall/store/category",data:{sid:i.sid,cid:i.cid}}).then(function(e){i.showPreLoading=!1;var s=e.data.message;if(s.errno)return t.$toast(s.message),!1;s=s.message,i.lazyload_goods=s.config_mall.lazyload_goods,i.store=i.util.extend({},s.store),i.cart=i.util.extend({},s.cart),i.replaceStore(s.store),i.replaceCart(s.cart.message.cart),i.util.setWXTitle(i.store.title),i.goodsItem.loading=!1,i.goodsItem.data=[].concat(n()(s.goods)),i.goodsItem.data.length<i.goodsItem.psize&&(i.goodsItem.finished=!0,i.goodsItem.data.length||(i.goodsItem.empty=1)),i.categoryAll=[].concat(n()(s.category)),i.categorySelectedId=s.cid,i.childSelectedId=s.child_id,i.categorySelectedIndex=s.cindex,i.goodsAll[i.categorySelectedIndex]=[],i.goodsAll[i.categorySelectedIndex][i.childSelectedIndex]=i.goodsItem,i.categorySelected=s.category[i.categorySelectedIndex]||{}})},selectPinadan:function(t){if(t>0){var i=this.util.getUrl({path:"/pages/store/goods",query:{sid:this.sid,pindan_id:t}});this.$router.replace(i)}},onToggleCategory:function(t,i,e){var s=0;"child"==e?(s=i,this.childSelectedIndex=s,this.categoryAll[this.categorySelectedIndex].childSelectedIndex=s,this.categorySelected=this.categoryAll[this.categorySelectedIndex]):(this.categoryAll[i].childSelectedIndex>0&&(s=this.categoryAll[i].childSelectedIndex),this.categorySelected=this.categoryAll[i],this.categorySelectedIndex=i,this.childSelectedIndex=s,this.categoryAll[i].childSelectedIndex=s),this.categorySelectedId=this.categorySelected.id,this.childSelectedId=0,this.categorySelected.child&&this.categorySelected.child.length>0&&(this.childSelectedId=this.categorySelected.child[s].id),this.onGetGoods()},onParentPlus:function(t,i,e,s,o){var a=this;this.goodsActive=i;var n=0;if(0==this.icart.pindan_id)if(1==this.icart.is_buysvip)n=1;else if(this.icart.svip_buy_show>=1&&1==i.svip_buy_show){if(1==o)return this.goodsActive.activeOption&&(this.goodsActive.activeOption.origin_price>0?this.goodsActive.origin_price=this.goodsActive.activeOption.origin_price:this.goodsActive.origin_price=this.goodsActive.activeOption.price,this.goodsActive.activeOption.svip_price>0?this.goodsActive.svip_price=this.goodsActive.activeOption.svip_price:this.goodsActive.svip_price=this.goodsActive.activeOption.price),void(this.popupBuySvip=!0);2==o?this.popupBuySvip=!1:3==o&&(this.popupBuySvip=!1,n=1)}var c=i.id||i.goods_id,d=i.activeOptionId||e,l={sid:this.istore.id,goods_id:c,option_id:d,num:1,sign:"+",is_buysvip:n};this.util.request({url:"wmall/store/goods/cart",data:l}).then(function(i){if((i=i.data.message).errno)return a.$toast(i.message),!1;i.message.msg&&a.$toast(i.message.msg);var e=t.target.getBoundingClientRect().left,o=t.target.getBoundingClientRect().bottom;"cart"==s&&(o+=50),a.elLeft=e,a.elBottom=o,a.showMoveDot.push(!0),a.replaceCart(i.message.cart)})},onParentMinus:function(t,i,e){var s=this,o=0;1==this.icart.is_buysvip&&(o=1);var a=t.id||t.goods_id,n=t.activeOptionId||i,c={sid:this.istore.id,goods_id:a,option_id:n,num:1,sign:"-",is_buysvip:o};this.util.request({url:"wmall/store/goods/cart",data:c}).then(function(t){if((t=t.data.message).errno)return s.$toast(t.message),!1;s.replaceCart(t.message.cart)})},onParentSelectOption:function(t){this.goodsActive=t,this.goods=t,this.ParentPopupSpecShow=!0,this.goods.activeOptions||this.onParentGoodsOptionInit()},onParentGoodsOptionInit:function(){if(this.goodsActive=this.goods,this.goodsActive.activeOptions={option:0,attrs:[],optionSelected:0,attrsSelected:[],num:0},1==this.goodsActive.is_options&&(this.goodsActive.activeOptions.option=this.goodsActive.options[0].id,this.goodsActive.activeOptions.optionSelected=this.goodsActive.options[0].id),1==this.goodsActive.is_attrs)for(var t=0;t<this.goodsActive.attrs.length;t++)this.goodsActive.activeOptions.attrs.push(t+"s0"),this.goodsActive.activeOptions.attrsSelected[t]=0;this.onParentToggleActiveOption()},onParentToggleOption:function(t,i,e){var s=this.goods;"option"==e?(s.activeOptions.option=t,s.activeOptions.optionSelected=t):(s.activeOptions.attrs[t]=t+"s"+i,s.activeOptions.attrsSelected[t]=i),this.goodsActive=s,this.onParentToggleActiveOption()},onParentToggleActiveOption:function(t){var i=this.goodsActive;t?i.activeOptionId=t:(i.activeOptionId=i.activeOptions.option,i.activeOptions.attrs.length>0&&(i.activeOptionId=i.activeOptionId+"_"+i.activeOptions.attrs.join("v"))),i.activeOption=i.options_data[i.activeOptionId],i.activeOption.num=this.parentGetSpecNum(),this.goodsActive=o()({},i)},onParentPopupNotInSailTime:function(t){this.goodsActive=t,this.popupNotInSailTime=!0},parentGetSpecNum:function(){if(!this.icart||!this.icart.data1||!this.icart.data1[this.goodsActive.id])return 0;var t=this.goodsActive.activeOptionId;return this.icart.data1[this.goodsActive.id][t]?this.icart.data1[this.goodsActive.id][t].num:0},onGetGoods:function(){var t=this;if(t.goodsAll[t.categorySelectedIndex]||(t.goodsAll[t.categorySelectedIndex]=[]),t.goodsItem=t.goodsAll[t.categorySelectedIndex][t.childSelectedIndex],t.goodsItem){if(t.goodsItem.empty)return!1;if(t.goodsItem.finished)return console.log("商品全部加载完成"),!1}else t.goodsItem={page:1,psize:30,loading:!0,finished:!1,empty:0,data:[]};t.goodsItem.loading=!0,t.util.request({url:"wmall/store/goods/goods",data:{sid:t.sid,page:t.goodsItem.page,psize:t.goodsItem.psize,cid:t.categorySelectedId,child_id:t.childSelectedId}}).then(function(i){t.goodsItem.loading=!1;var e=i.data.message.message;t.goodsItem.data=[].concat(n()(t.goodsItem.data),n()(e.goods)),t.goodsItem.page++,e.goods.length<t.goodsItem.psize&&(t.goodsItem.finished=!0,e.goods.length||(t.goodsItem.empty=1)),t.goodsAll[t.categorySelectedIndex]||(t.goodsAll[t.categorySelectedIndex]=[]),t.goodsAll[t.categorySelectedIndex][t.childSelectedIndex]=t.goodsItem})},showMoveDotFun:function(t,i,e){this.showMoveDot.push(!0),this.elLeft=i,this.elBottom=e},onParentBeforeEnter:function(t){t.style.bottom=this.windowHeight-this.elBottom+"px",t.style.left=this.elLeft+5+"px",t.style.opacity=0},onParentAfterEnter:function(t){var i=this;t.style.bottom="-20px",t.style.left="20px",t.style.opacity=1,setTimeout(function(){i.replaceState({key:"cart_animate",val:!0})},400)}}),computed:d()({},Object(l.c)(["istore","icart"]),{goodsSpecNum:function(){if(!this.icart||!this.icart.data1||!this.icart.data1[this.goodsActive.id])return 0;var t=this.goodsActive.activeOptionId;return this.icart.data1[this.goodsActive.id][t]?this.icart.data1[this.goodsActive.id][t].num:0}}),mounted:function(){var t=this,i=this.util.parseQuery(this.$route.query);i.sid>0&&(this.sid=i.sid),i.cid>0&&(this.cid=i.cid),this.onLoad(),setTimeout(function(){t.windowHeight=window.innerHeight},50)},watch:{$route:function(t,i){}}},_={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{attrs:{id:"store-category"}},[e("public-header",{attrs:{title:t.store.title}}),t._v(" "),e("div",{staticClass:"container",class:{"has-child-4":t.categorySelected&&t.categorySelected.child&&t.categorySelected.child.length>0&&t.categorySelected.child.length<=4,"has-child-8":t.categorySelected&&t.categorySelected.child&&t.categorySelected.child.length>4}},[e("div",{staticClass:"category-container bg-default"},[e("van-swipe",{attrs:{width:90,height:97,"show-indicators":!1,loop:!1}},t._l(t.categoryAll,function(i,s){return e("van-swipe-item",{key:i.id,staticClass:"cate-item",class:{active:i.id==t.categorySelectedId},on:{click:function(e){return t.onToggleCategory(i.id,s,"")}}},[e("div",{staticClass:"img-wrap"},[e("img",{staticClass:"img-100",attrs:{src:i.thumb,alt:""}})]),t._v(" "),e("div",{staticClass:"cate-title ellipsis"},[t._v(t._s(i.title))])])}),1),t._v(" "),t.categorySelected&&t.categorySelected.child&&t.categorySelected.child.length>0?e("div",{staticClass:"category-children van-hairline--top"},t._l(t.categorySelected.child,function(i,s){return e("div",{key:i.id,staticClass:"cate-child-item ",on:{click:function(e){return t.onToggleCategory(i.id,s,"child")}}},[e("div",{staticClass:"child-inner ellipsis",class:{active:i.id==t.childSelectedId}},[t._v(t._s(i.title))])])}),0):t._e()],1),t._v(" "),e("van-list",{staticClass:"goods-container",attrs:{finished:t.goodsItem.finished,offset:50,"immediate-check":!1},on:{load:t.onGetGoods},model:{value:t.goodsItem.loading,callback:function(i){t.$set(t.goodsItem,"loading",i)},expression:"goodsItem.loading"}},[1==t.store.goods_style?[e("div",{staticClass:"diy-goods-single-row"},t._l(t.goodsItem.data,function(i){return e("div",{key:i.id,staticClass:"goods-item"},[e("router-link",{staticClass:"goods-img",attrs:{tag:"div",to:t.util.getUrl({path:"/pages/store/goodsDetail",query:{id:i.id,sid:t.store.id}})}},[e("img",{directives:[{name:"lazy",rawName:"v-lazy",value:{src:i.thumb,loading:t.lazyload_goods},expression:"{src: item.thumb, loading: lazyload_goods}"}]}),t._v(" "),i.unitnum>1?e("div",{staticClass:"discount hide"},[t._v(t._s(i.unitnum_multi_cn)+"购")]):t._e()]),t._v(" "),e("router-link",{staticClass:"goods-info",attrs:{tag:"div",to:t.util.getUrl({path:"/pages/store/goodsDetail",query:{id:i.id,sid:t.store.id}})}},[e("div",[e("div",{staticClass:"goods-name"},[t._v(t._s(i.title))]),t._v(" "),e("div",{staticClass:"sale-num"},[t._v("已售:"+t._s(i.sailed)+" 好评率:"+t._s(i.comment_good_percent))]),t._v(" "),1!=i.svip_status||i.discount_price?e("div",{staticClass:"discount"},[i.discount?[e("van-icon",{attrs:{name:"tag"}}),t._v("\n\t\t\t\t\t\t\t\t\t\t"+t._s(i.discount)+"折 限"+t._s(i.max_buy_limit)+"份 "+t._s(i.unitnum>1?i.unitnum_multi_cn+"购":"")+"\n\t\t\t\t\t\t\t\t\t")]:i.unitnum>1?[e("van-icon",{attrs:{name:"tag"}}),t._v(t._s(i.unitnum_multi_cn)+"购\n\t\t\t\t\t\t\t\t\t")]:t._e()],2):e("div",{staticClass:"svip-price-tips"},[e("div",{staticClass:"svip-price"},[e("i",{staticClass:"icon icon-crownfill"}),t._v(" "),e("span",[t._v(t._s(i.discount)+"折")])]),t._v(" "),e("div",{staticClass:"svip-activity"},[t._v("超级会员专享")]),t._v(" "),i.unitnum>1?e("div",{staticClass:"discount margin-10-l"},[e("van-icon",{attrs:{name:"tag"}}),t._v(t._s(i.unitnum_multi_cn)+"购\n\t\t\t\t\t\t\t\t\t")],1):t._e()])]),t._v(" "),e("div",[e("div",{staticClass:"goods-price"},[e("div",{staticClass:"in-b now-price"},[t._v(t._s(t.Lang.dollarSign)+t._s(i.price)),e("span",{staticClass:"font-14"},[t._v(t._s(i.unitname_cn))])]),t._v(" "),i.old_price>0?e("div",{staticClass:"in-b old-price"},[t._v(t._s(t.Lang.dollarSign)+t._s(i.old_price))]):t._e()])])]),t._v(" "),e("goods-handle",{attrs:{goods:i,optionId:0,from:"list"},on:{onParentPlus:t.onParentPlus,onParentSelectOption:t.onParentSelectOption,onParentPopupNotInSailTime:t.onParentPopupNotInSailTime,showMoveDot:t.showMoveDotFun}})],1)}),0)]:2==t.store.goods_style?[e("div",{staticClass:"diy-goods-double-row"},t._l(t.goodsItem.data,function(i){return e("div",{key:i.id,staticClass:"goods-item"},[e("div",{staticClass:"goods-item-inner"},[e("router-link",{staticClass:"goods-img",attrs:{tag:"div",to:t.util.getUrl({path:"/pages/store/goodsDetail",query:{id:i.id,sid:t.store.id}})}},[e("img",{directives:[{name:"lazy",rawName:"v-lazy",value:{src:i.thumb,loading:t.lazyload_goods},expression:"{src: item.thumb, loading: lazyload_goods}"}]}),t._v(" "),(1!=i.svip_status||i.discount_price>0)&&i.discount>0?e("div",{staticClass:"discount"},[e("div",[e("van-icon",{attrs:{name:"tag"}}),t._v(" "+t._s(i.discount)+"折 限"+t._s(i.max_buy_limit)+"份 "+t._s(i.unitnum>1?i.unitnum_multi_cn+"":"")+"\n\t\t\t\t\t\t\t\t\t")],1)]):t._e(),t._v(" "),i.unitnum>1&&!i.discount_price?e("div",{staticClass:"discount"},[e("div",[e("van-icon",{attrs:{name:"tag"}}),t._v(" "+t._s(i.unitnum_multi_cn)+"\n\t\t\t\t\t\t\t\t\t")],1)]):t._e()]),t._v(" "),e("router-link",{staticClass:"goods-info",attrs:{tag:"div",to:t.util.getUrl({path:"/pages/store/goodsDetail",query:{id:i.id,sid:t.store.id}})}},[e("div",{staticClass:"info-top"},[e("div",{staticClass:"goods-name"},[t._v(t._s(i.title))]),t._v(" "),1!=i.svip_status||i.discount_price?e("div",{staticClass:"sale-num"},[t._v("已售:"+t._s(i.sailed)+" 好评率:"+t._s(i.comment_good_percent))]):e("div",{staticClass:"svip-price-tips"},[e("div",{staticClass:"svip-price"},[e("span",{staticClass:"ellipsis"},[t._v(t._s(i.discount)+"折")])]),t._v(" "),e("div",{staticClass:"svip-activity ellipsis"},[t._v("超级会员专享")])])]),t._v(" "),e("div",{staticClass:"goods-price"},[e("div",{staticClass:"now-price"},[t._v(t._s(t.Lang.dollarSign)+t._s(i.price)),e("span",{staticClass:"font-14"},[t._v(t._s(i.unitname_cn))])]),t._v(" "),i.old_price>0?e("div",{staticClass:"old-price margin-5-t"},[t._v(t._s(t.Lang.dollarSign)+t._s(i.old_price))]):t._e()])]),t._v(" "),e("goods-handle",{attrs:{goods:i,optionId:0,from:"list"},on:{onParentPlus:t.onParentPlus,onParentSelectOption:t.onParentSelectOption,onParentPopupNotInSailTime:t.onParentPopupNotInSailTime,showMoveDot:t.showMoveDotFun}})],1)])}),0)]:t._e(),t._v(" "),1==t.goodsItem.empty?e("load",{attrs:{type:"loaded",text:"暂无商品",bgcolor:"#f5f5f5"}}):t.goodsItem.finished?e("load",{attrs:{type:"loaded",text:"已经到底了",bgcolor:"#f5f5f5"}}):t._e()],2)],1),t._v(" "),e("store-cart",{attrs:{show:"1",store:t.store,cart:t.cart,pindan_id:0},on:{selectPinadan:t.selectPinadan}}),t._v(" "),t.popupNotInSailTime?e("van-popup",{staticClass:"not-in-time-popup",model:{value:t.popupNotInSailTime,callback:function(i){t.popupNotInSailTime=i},expression:"popupNotInSailTime"}},[e("div",{staticClass:"popup-top"},[t.goodsActive.week_cn?e("div",{staticClass:"popup-item"},[e("div",{staticClass:"popup-title"},[t._v("每周可售日期")]),t._v(" "),e("div",{staticClass:"popup-text"},[t._v(t._s(t.goodsActive.week_cn))])]):t._e(),t._v(" "),t.goodsActive.time_cn?e("div",{staticClass:"popup-item"},[e("div",{staticClass:"popup-title"},[t._v("每天可售时间")]),t._v(" "),e("div",{staticClass:"popup-text"},[t._v("\n\t\t\t\t\t"+t._s(t.goodsActive.time_cn)+"\n\t\t\t\t")])]):t._e()]),t._v(" "),e("div",{staticClass:"popup-bottom border-1px-t",on:{click:function(i){t.popupNotInSailTime=!1}}},[t._v("知道了")])]):t._e(),t._v(" "),t.ParentPopupSpecShow?e("van-popup",{staticClass:"options-popup",model:{value:t.ParentPopupSpecShow,callback:function(i){t.ParentPopupSpecShow=i},expression:"ParentPopupSpecShow"}},[e("div",{staticClass:"options-dialog"},[e("div",{staticClass:"muti-close",on:{click:function(i){t.ParentPopupSpecShow=!1}}}),t._v(" "),e("div",{staticClass:"muti-wrap"},[e("div",{staticClass:"muti-food-title border-1px-b"},[t._v("\n\t\t\t\t\t"+t._s(t.goodsActive.title)+"\n\t\t\t\t")]),t._v(" "),e("div",{staticClass:"muti-cont"},[e("div",{staticClass:"muti-cont-inner"},[1==t.goodsActive.is_options?e("div",{staticClass:"muti-sec first"},[e("div",{staticClass:"muti-sec-title"},[t._v("规格")]),t._v(" "),e("div",{staticClass:"muti-choice"},[t._l(t.goodsActive.options,function(i,s){return[e("div",{class:{selected:t.goodsActive.activeOptions.optionSelected==i.id},on:{click:function(e){return t.onParentToggleOption(i.id,"","option")}}},[t._v(t._s(i.name))])]})],2)]):t._e(),t._v(" "),1==t.goodsActive.is_attrs?e("div",{staticClass:"muti-sec"},[t._l(t.goodsActive.attrs,function(i,s){return[e("div",{staticClass:"muti-sec-title"},[t._v(t._s(i.name))]),t._v(" "),e("div",{staticClass:"muti-choice"},[t._l(i.label,function(i,o){return[e("div",{class:{selected:t.goodsActive.activeOptions.attrsSelected[s]==o},on:{click:function(i){return t.onParentToggleOption(s,o,"attr")}}},[t._v(t._s(i))])]})],2)]})],2):t._e()])]),t._v(" "),e("div",{staticClass:"muti-choose"},[e("div",{staticClass:"muti-oprt"},[e("div",{staticClass:"muti-cart-oprt clearfix"},[e("div",{staticClass:"add-food"},[e("van-icon",{staticStyle:{"background-color":"#6BBA50"},attrs:{name:"plus"},on:{click:function(i){return t.onParentPlus(i,t.goodsActive,"","","1")}}})],1),t._v(" "),t.goodsSpecNum?[e("div",{staticClass:"food-num"},[t._v(t._s(t.goodsSpecNum))]),t._v(" "),e("div",{staticClass:"remove-food"},[e("div",{staticClass:"remove icon icon-minus",on:{click:function(i){return t.onParentMinus(t.goodsActive)}}})])]:t._e()],2)]),t._v(" "),e("div",{staticClass:"muti-info"},[e("div",{staticClass:"muti-price"},[t._v(t._s(t.Lang.dollarSign)+t._s(t.goodsActive.activeOption.price))]),t._v(" "),e("div",{staticClass:"muti-type"},[t._v("("+t._s(t.goodsActive.activeOption.name)+")")])])])])])]):t._e(),t._v(" "),t._l(t.showMoveDot,function(i,s){return e("transition",{key:s,attrs:{appear:""},on:{"after-appear":t.onParentAfterEnter,"before-appear":t.onParentBeforeEnter}},[i?e("div",{staticClass:"parent_move_dot"}):t._e()])}),t._v(" "),e("van-popup",{staticClass:"buy-svip",model:{value:t.popupBuySvip,callback:function(i){t.popupBuySvip=i},expression:"popupBuySvip"}},[e("div",{staticClass:"popup-svip-title"},[t._v("客官，专享价限超级会员享受哦")]),t._v(" "),e("div",{staticClass:"svip-img"},[e("div",{staticClass:"svip-vs-left"},[e("i",{staticClass:"icon icon-crownfill"}),t._v(" "),e("div",{staticClass:"font-12"},[t._v("会员专享价")]),t._v(" "),e("div",{staticClass:"svip-vs-price"},[e("span",{staticClass:"font-14"},[t._v(t._s(t.Lang.dollarSign))]),t._v(t._s(t.goodsActive.svip_price))])]),t._v(" "),e("div",{staticClass:"svip-vs-right"},[e("div",{staticClass:"svip-putong-title"},[t._v("普通用户价格")]),t._v(" "),e("div",{staticClass:"svip-putong-price"},[e("span",{staticClass:"font-14"},[t._v(t._s(t.Lang.dollarSign))]),t._v(t._s(t.goodsActive.origin_price))])])]),t._v(" "),e("div",{staticClass:"buy-svip-text"},[t._v("即刻加入超级会员，尊享众多会员优惠")]),t._v(" "),e("button",{staticClass:"svip-price-btn font-16 margin-15-t"},[e("div",{staticClass:"font-bold",on:{click:function(i){return t.onParentPlus(i,t.goodsActive,"","","3")}}},[t._v("会员专享价购买")]),t._v(" "),e("div",{staticClass:"font-12 padding-5-t"},[t._v("(订单结算时成为会员享优惠)")])]),t._v(" "),e("van-button",{staticClass:"price-btn font-16 margin-15-t",attrs:{size:"normal"},on:{click:function(i){return t.onParentPlus(i,t.goodsActive,"","","2")}}},[t._v("原价购买")])],1),t._v(" "),t.showPreLoading?e("iloading"):t._e()],2)},staticRenderFns:[]};var h=e("VU/8")(u,_,!1,function(t){e("oP8E")},null,null);i.default=h.exports},oP8E:function(t,i){}});
//# sourceMappingURL=121.c079ec7d5da966234cbd.js.map